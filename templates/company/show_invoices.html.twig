{% extends 'base.html.twig' %}

{% block title %}Quantique | Ajouter une entreprise{% endblock %}

{% block body %}

<!-- MODAL EDIT USER -->
{% for user in company.users %}
{% include "partials/_modal_edit_user.html.twig" with {'company': company} %}
{% endfor %}
<!-- MODAL DELETE USER -->
{% include "partials/_modal_delete_user.html.twig" %}
<!-- MODAL DELETE INVOICE -->
{% include "partials/_modal_delete_invoice.html.twig" %}
<!-- MODAL EDIT PASSWORD -->
<div id="modal-edit-password{{app.user.id}}" class="mdl-edit-password">
    <div class="cont-flex-space mdl-header-form">
        <div class="cont-flex">
            <i class="fas fa-unlock-alt fa-2x"></i>
            <h2>Mot de passe</h2>
        </div>
        <a class="mdl-close action-link">✖</a>
    </div>
    {{ form_start(edit_password_form) }}
    <div class="form-section">
        <label for="company">Identifiant</label>
        <input class="form-control" type="text" value="{{app.user.email}}" readonly>
    </div>
    <div class="form-section cont-grid">
        {{ form_row(edit_password_form.password) }}
    </div>
    <div class="cont-flex">
        <div class="cont-flex-space mdl-btn">
            {{ form_row(edit_password_form.submit) }}
            <a class="mdl-close-btn btn-type btn-form btn-cancel">Annuler</a>
        </div>
    </div>
    {{ form_end(edit_password_form) }}
</div>
<!-- MODAL ADD INVOICE -->
<div id="modal-invoice" class="mdl-add-invoice">
    <div class="cont-flex-start cont-title mdl-header-form">
        <div class="cont-flex">
            <i class="fas fa-file-upload fa-2x"></i>
            <h2>Factures</h2>
        </div>
        <a class="mdl-close action-link">✖</a>
    </div>
    {{form_start(add_invoice_form)}}
    <div class="cont-grid form-section">
        <div>
            <label for="cmp">Entreprise *</label>
            <input id="cmp" class="form-control" name="cmp" value="{{company.name}}" readonly>
        </div>
        <div>
            <label for="type">Type *</label>
            <select class="form-select" name="type">
                {% for type in typesInvoice %}
                <option value="{{type.name}}">{{type.name}}</option>
                {% endfor %}
            </select>
        </div>
    </div>
    <div class="cont-grid form-section">
        {{form_row(add_invoice_form.files)}}
        <div>
            <label for="date">Date de facturation *</label>
            <input id="date" class="form-control" type="date" name="date" value="{{currentDate|date('Y-m-d')}}">
        </div>
    </div>
    <div class="cont-flex-space mdl-btn">
        {{form_row(add_invoice_form.submit)}}
        <a class="mdl-close-btn btn-type btn-form btn-cancel">Annuler</a>
    </div>
    {{form_end(add_invoice_form)}}
</div>

<body>

    <div class="container">
        {% include "partials/_company_info.html.twig" %}

        {% if is_granted('ROLE_ADMIN') %}
        <a id="add-invoice{{company.id}}" class="btn-type right btn10 add-invoice">Nouvelle
            facture</a>
        {% endif %}

        <ul class="nav nav-tabs nav-tabs-company">
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab"
                    href="{{path('show_contracts', {'company': company.id})}}">Abonnements</a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab"
                    href="{{path('show_invoices', {'company': company.id})}}">Factures</a>
            </li>
            {# {% if is_granted('ROLE_ADMIN') %}
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab"
                    href="{{path('show_accounts', {'company': company.id})}}">Comptes</a>
            </li>
            {% elseif app.user %} #}
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab"
                    href="{{path('show_stats', {'company': company.id})}}">Statistiques</a>
            </li>
            {# {% endif %} #}
        </ul>

        <div>
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th scope="col">Date</th>
                        <th scope="col">Type</th>
                        <th scope="col">Nom</th>
                        <th scope="col">Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for invoice in company.invoices %}
                    <tr class="table-light">
                        <td>{{ invoice.releasedAt|date("d/m/Y") }}</td>
                        <td>{{ invoice.type.name }}</td>
                        <td>{{ invoice.file }}</td>
                        <td>
                            <ul class="action-list">
                                <li class="action-item cont-flex-space">
                                    <a href="{{path('download_invoice', {'id': invoice.id})}}" class="action-link"
                                        title="Télécharger la facture">
                                        <i class="fas fa-lg fa-file-download"></i>
                                    </a>
                                </li>
                                <li class="action-item">
                                    <a id="delete-invoice{{invoice.id}}" class="action-link delete-invoice"
                                        title="Supprimer la facture">
                                        <i class="fas fa-times fa-lg"></i>
                                    </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</body>

<script>
    const cont = document.querySelector('.container');
    const navbar = document.querySelector('.navbar');
    const buttons = document.querySelectorAll('.container a, .navbar a, .contract-item');
</script>

<script src="{{asset('js/add_entity_modal.js')}}" nb="2" param1="user" param2="invoice"></script>
<script src="{{asset('js/edit_entity_modal.js')}}" nb="1" param1="user"></script>
<script src="{{asset('js/delete_entity_modal.js')}}" nb="2" param1="invoice" param2="user"></script>

{% endblock %}