{% if is_granted('ROLE_ADMIN') %}
{% for website in company.websites %}
{% for contract in website.contracts %}
<div id="notepad{{contract.id}}" class="notepad">
    <div class="notepad-header cont-flex-space">
        <p class="notepad-title">{{website.name}} : {{contract.type.name}}</p>
        <a id="notepad-close{{contract.id}}" class="nav-link">âœ–</a>
    </div>
    <div class="notepad-content">
        <div class="notepad-notes">
            {% for note in contract.notes|reverse %}
            <div class="notepad-item">
                <p class="note-date">{{note.releasedAt|date("d/m/Y")}}</p>
                <p class="note-msg">{{note.message|nl2br}}</p>
                <a class="nav-link" href="{{path('delete_note', {'note': note.id})}}" title="Supprimer la note">
                    <i class="fas fa-times"></i>
                </a>
            </div>
            {% endfor %}
        </div>
        <form method="POST" id="form-add-note{{contract.id}}" class="cont-note form-add-note">
            <div hidden>
                <label for="contract">Contrat</label>
                <input class="form-control" name="contract" value="{{contract.id}}"></input>
            </div>
            <div>
                <label id="{{app.user.id}}" class="user" for="message">Message</label>
                <textarea id="msg" class="form-control" name="message" rows="1" required></textarea>
            </div>
            <a id="notepad-submit{{contract.id}}" class="btn-type btn-form notepad-btn" onclick="submit({{contract.id}})">Envoyer</a>
        </form>
        <!-- <form id="form-add-note{{contract.id}}" class="cont-note form-add-note" data-path="{{asset('js/script/add-note.php')}}" method="POST">
            <div hidden>
                <label for="contract">Contrat</label>
                <input class="form-control" name="contract" value="{{contract.id}}"></input>
            </div>
            <div>
                <label id="{{app.user.id}}" class="user" for="message">Message</label>
                <textarea id="msg" class="form-control" name="message" rows="1" required></textarea>
            </div>
            <button id="notepad-submit{{contract.id}}" class="btn-type btn-form notepad-btn">Envoyer</button>
        </form> -->
    </div>
</div>
{% endfor %}
{% endfor %}
{% endif %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script>

    function submit(id) {
        const form = document.querySelector('#form-add-note'+id)
        const user = form.querySelector('.user').id;
        const contract = form.id.substr(13);
        const msg = form.querySelector('#msg').value;
        $.ajax({
            type: 'post',
            url: './script/add-note.php',
            data: {
                user : user,
                contract : contract,
                msg : msg,
            }
        });
    }

    //const forms = document.querySelectorAll('.form-add-note');
    //forms.forEach(function(form){
    //    const user = form.querySelector('.user').id;
    //    const contract = form.id.substr(13);
    //    const msg = form.querySelector('#msg').value;

    //    $("#form-add-note"+contract).submit(function(event) {
    //        $.ajax({
    //            type: 'post',
    //            url: './script/add-note.php',
    //            data: {
    //                user : user,
    //                contract : contract,
    //                msg : msg,
    //            }
    //        });
    //    });
    
    //    $("#notepad-submit"+contract).click(function(e) {
            
    //    });
    //});
    

</script>



